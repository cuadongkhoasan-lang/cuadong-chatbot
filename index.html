<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tr·ª£ l√Ω g√≥i sinh C·ª≠a ƒê√¥ng</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="importmap">
{
  "imports": {
    "@google/generative-ai": "https://esm.run/@google/generative-ai"
  }
}
</script>
</head>

<body class="bg-gray-100">
<div class="max-w-xl mx-auto mt-4 p-4 bg-white rounded shadow">
  <h2 class="text-xl font-bold text-blue-700 mb-3">Tr·ª£ l√Ω t∆∞ v·∫•n g√≥i sinh C·ª≠a ƒê√¥ng</h2>

  <div id="chat" class="h-96 overflow-y-auto border p-2 rounded bg-gray-50"></div>

  <div class="mt-3 flex gap-2">
    <input id="inp" class="flex-1 border px-3 py-2 rounded" placeholder="Nh·∫≠p c√¢u h·ªèi...">
    <button id="btn" class="bg-blue-600 text-white px-4 py-2 rounded">G·ª≠i</button>
  </div>
</div>

<!-- Floating hotline -->
<a href="tel:02386269999"
   class="fixed bottom-5 right-5 bg-red-600 text-white px-4 py-3 rounded-full shadow-xl font-bold">
üìû G·ªçi 0238.626.9999
</a>

<script type="module">
import { GoogleGenerativeAI } from "@google/generative-ai";

const apiKey = "AIzaSyCL2Doc6pHGVFewYxYulHM91GV0WZsKYpM";
const genAI = new GoogleGenerativeAI(apiKey);
const model = genAI.getGenerativeModel({ model: "gemini-pro" });

let knowledge = [];

fetch("data.json").then(r => r.json()).then(d => {
  knowledge = [
    d.hospital.name, d.hospital.address, d.hospital.hotline, d.hospital.website,
    ...d.packages.flatMap(p => [
      p.package_name,
      p.room_type,
      ...Object.entries(p.prices).map(([k,v]) => `${p.package_name} - ${k}: ${v}`),
      ...p.included.map(i => `${p.package_name} - bao g·ªìm: ${i}`)
    ]),
    ...d.extra_fees,
    ...d.promotions,
    ...d.refund_policy
  ];
});

function search(q){
  const t = q.toLowerCase().split(/\s+/).filter(x => x.length>1);
  return knowledge.filter(l => {
    const L = l.toLowerCase();
    return t.some(k => L.includes(k));
  });
}

function addMsg(text, from="bot"){
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = from==="bot" ?
      "bg-gray-200 p-2 my-1 rounded" :
      "bg-blue-600 text-white p-2 my-1 rounded ml-auto w-fit";
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

document.getElementById("btn").onclick = async () => {
  const q = document.getElementById("inp").value.trim();
  if(!q) return;
  addMsg(q, "user");
  document.getElementById("inp").value = "";

  const matched = search(q);
  const ctx = matched.length ?
      matched.join("\n") :
      "KH√îNG C√ì D·ªÆ LI·ªÜU PH√ô H·ª¢P TRONG JSON.\nH√£y tr·∫£ v·ªÅ: Trong d·ªØ li·ªáu g√≥i sinh hi·ªán t·∫°i ch∆∞a c√≥ th√¥ng tin n√†y. Vui l√≤ng li√™n h·ªá hotline 0238.626.9999.";

  const prompt = `
B·∫°n l√† tr·ª£ l√Ω g√≥i sinh. Ch·ªâ tr·∫£ l·ªùi d·ª±a tr√™n d·ªØ li·ªáu sau:

--------
${ctx}
--------

N·∫øu d·ªØ li·ªáu ch·ª©a "KH√îNG C√ì D·ªÆ LI·ªÜU PH√ô H·ª¢P TRONG JSON" th√¨ tr·∫£ v·ªÅ ƒë√∫ng:
"Trong d·ªØ li·ªáu g√≥i sinh hi·ªán t·∫°i ch∆∞a c√≥ th√¥ng tin n√†y. Vui l√≤ng li√™n h·ªá hotline 0238.626.9999."

C√¢u h·ªèi: "${q}"
  `;

  try{
    const result = await model.generateContent(prompt);
    addMsg(result.response.text(), "bot");
  }catch(e){
    addMsg("L·ªói k·∫øt n·ªëi AI.","bot");
  }
};

addMsg("Xin ch√†o! T√¥i l√† tr·ª£ l√Ω g√≥i sinh c·ªßa B·ªánh vi·ªán C·ª≠a ƒê√¥ng. B·∫°n c·∫ßn h·ªó tr·ª£ g√¨?");
</script>

</body>
</html>
